import React, {useState} from 'react';
import {CSSTransition, SwitchTransition} from 'react-transition-group'

import classes from 'modules/header/components/auth_modal/AuthModal.module.css'
import AuthToggle from 'modules/header/components/auth_toggle/AuthToggle'
import {LOGIN_TOGGLE} from 'modules/header/constants'
import {useDispatch} from "react-redux";
import {getAuthModalOffAction} from 'modules/header/store/auth_modal_store/actionCreator'
import LoginForm from 'modules/header/components/login_form/LoginForm'
import RegistrationForm from 'modules/header/components/registration_form/RegistrationForm'

const AuthModal = (props) => {
    const [toggleState, setToggleState] = useState(LOGIN_TOGGLE)
    const dispatch = useDispatch()

    const toggleStateHandler = state => {
        setToggleState(state)
    }

    function modalVisibleHandler(e) {
        if (e.target.classList.contains(classes.modal)) {
            dispatch(getAuthModalOffAction())
        }
    }

    return (
        <div
            className={classes.modal}
            onClick={e => modalVisibleHandler(e)}
        >
            <div className={classes.modalContent}>
                <AuthToggle
                    setToggleState={toggleStateHandler}
                    toggleState={toggleState}
                />
                <SwitchTransition>
                    <CSSTransition
                        key={toggleState}
                        timeout={300}
                        classNames={{
                            enterActive: classes.formActive,
                            exitActive: classes.formInactive
                        }}
                    >
                        {toggleState === LOGIN_TOGGLE ? <LoginForm/> : <RegistrationForm/> }
                    </CSSTransition>
                </SwitchTransition>
            </div>
        </div>
    );
};

export default AuthModal;